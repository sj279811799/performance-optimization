# 解锁浏览器背后的运行机制

## 浏览器内核

主要由渲染引擎和JS引擎两部分组成。

主要的内核包括：Trident(IE)，Gecko(火狐)，Blink(Chrome,Opera)，Webkit(Safari)。

## 渲染过程

解析Html生成DOM树，解析css生成CSSOM树，上面两步是并行的。然后二者结合生成Render树。然后计算元素的大小位置等。最后对渲染树进行绘制。

## CSS优化

css选择符是从右到左进行匹配的，所以如果在最右边写标签选择器，会导致浏览器遍历一遍页面上所有的这个标签。

提升方案：

- 避免使用通配符

- 避免重复匹配，重复定义

- 少用标签选择器

- 不要画蛇添足，id、class选择器不应该被多余的标签选择器拖后腿。

- 减少嵌套，最高不要超过三层。

## CSS与JS加载顺序优化

### CSS阻塞

由于DOM必须和CSSDOM一同生成RenderDOM，但css又是通过dom中的link或style获取的，所以DOM要等待CSSDOM。所以CSS要尽早尽快下载到客户端。将css放在head中，或者启用cdn。

### JS阻塞

JS是放在HTML中的，渲染引擎渲染过程中，碰到script时，会将控制权交给JS引擎，处理完成后，才会将控制权交回。

JS三种加载方式：

- 正常模式：会阻塞浏览器。

- async模式：加载异步，加载结束，阻塞渲染，立即执行。

- defer模式：加载异步，执行推迟到文档解析完成。